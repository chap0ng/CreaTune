<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tone.js Synth Prototype</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background-color: #121212;
      overflow: hidden;
      font-family: system-ui, -apple-system, sans-serif;
    }
    
    #container {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      height: 100vh;
      width: 100%;
      position: relative;
    }
    
    #visualizer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 70%;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #buttons {
      display: flex;
      gap: 30px;
      justify-content: center;
      align-items: center;
      position: absolute;
      bottom: 100px;
      z-index: 2;
    }
    
    .button {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      cursor: pointer;
      border: none;
      transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
    }
    
    .button:hover {
      transform: scale(1.05);
    }
    
    .button:active {
      transform: scale(0.95);
    }
    
    #button1 {
      background-color: #8B735A;
    }
    
    #button2 {
      background-color: #9C6644;
    }
    
    #button3 {
      background-color: #567568;
    }
    
    .button.active {
      box-shadow: 0 0 20px 5px rgba(255, 255, 255, 0.4);
    }
    
    #button1.active {
      background-color: #D7C0AE;
    }
    
    #button2.active {
      background-color: #C8AE7D;
    }
    
    #button3.active {
      background-color: #A9C0A6;
    }
    
    .shape {
      position: absolute;
      opacity: 0;
      transition: opacity 0.5s;
    }
    
    .shape1 {
      width: 150px;
      height: 150px;
      background-color: rgba(139, 115, 90, 0.8);
      border-radius: 50%;
    }
    
    .shape2 {
      width: 150px;
      height: 150px;
      background-color: rgba(156, 102, 68, 0.8);
      clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
    }
    
    .shape3 {
      width: 150px;
      height: 150px;
      background-color: rgba(86, 117, 104, 0.8);
      clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
    }
    
    .shape4 {
      width: 150px;
      height: 150px;
      background-color: rgba(215, 192, 174, 0.8);
      border-radius: 5px;
      transform: rotate(45deg);
    }
    
    .shape5 {
      width: 150px;
      height: 150px;
      background-color: rgba(200, 174, 125, 0.8);
      clip-path: polygon(50% 0%, 83% 12%, 100% 43%, 94% 78%, 68% 100%, 32% 100%, 6% 78%, 0% 43%, 17% 12%);
    }
    
    .shape6 {
      width: 150px;
      height: 150px;
      background-color: rgba(169, 192, 166, 0.8);
      clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
    }
    
    .shape7 {
      width: 150px;
      height: 150px;
      background-color: rgba(193, 163, 132, 0.8);
      border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
    }
    
    #status {
      color: white;
      position: absolute;
      bottom: 20px;
      text-align: center;
      font-size: 14px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="visualizer">
      <div class="shape shape1"></div>
      <div class="shape shape2"></div>
      <div class="shape shape3"></div>
      <div class="shape shape4"></div>
      <div class="shape shape5"></div>
      <div class="shape shape6"></div>
      <div class="shape shape7"></div>
    </div>
    
    <div id="buttons">
      <button class="button" id="button1"></button>
      <button class="button" id="button2"></button>
      <button class="button" id="button3"></button>
    </div>
    
    <div id="status">Click any button to start</div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize variables
      let audioStarted = false;
      const statusEl = document.getElementById('status');
      const buttons = {
        button1: document.getElementById('button1'),
        button2: document.getElementById('button2'),
        button3: document.getElementById('button3')
      };
      
      const shapes = {
        shape1: document.querySelector('.shape1'),
        shape2: document.querySelector('.shape2'),
        shape3: document.querySelector('.shape3'),
        shape4: document.querySelector('.shape4'),
        shape5: document.querySelector('.shape5'),
        shape6: document.querySelector('.shape6'),
        shape7: document.querySelector('.shape7')
      };
      
      const state = {
        button1: false,
        button2: false,
        button3: false
      };
      
      const synths = {};
      
      // Test audio with a simple sound
      function testAudio() {
        const testSynth = new Tone.Synth().toDestination();
        testSynth.triggerAttackRelease("C4", "8n");
      }
      
      // Create all synths
      function createSynths() {
        console.log("Creating synths...");
        
        // Base volume for all synths
        const baseVolume = -8;
        
        // Synth 1: Simple sine wave synth with longer attack
        synths.synth1 = new Tone.Synth({
          oscillator: {
            type: "sine"
          },
          envelope: {
            attack: 0.5,
            decay: 0.3,
            sustain: 0.8,
            release: 1.5
          },
          volume: baseVolume
        }).toDestination();
        
        // Synth 2: Triangle wave synth
        synths.synth2 = new Tone.Synth({
          oscillator: {
            type: "triangle"
          },
          envelope: {
            attack: 0.3,
            decay: 0.1,
            sustain: 0.6,
            release: 1.2
          },
          volume: baseVolume
        }).toDestination();
        
        // Synth 3: Square wave synth
        synths.synth3 = new Tone.Synth({
          oscillator: {
            type: "square"
          },
          envelope: {
            attack: 0.4,
            decay: 0.2,
            sustain: 0.5,
            release: 1.0
          },
          volume: baseVolume
        }).toDestination();
        
        // Synth 4: AM Synth (1+2)
        synths.synth4 = new Tone.AMSynth({
          harmonicity: 1.5,
          envelope: {
            attack: 0.3,
            decay: 0.2,
            sustain: 0.7,
            release: 1.5
          },
          volume: baseVolume
        }).toDestination();
        
        // Synth 5: FM Synth (1+3)
        synths.synth5 = new Tone.FMSynth({
          harmonicity: 3,
          modulationIndex: 10,
          envelope: {
            attack: 0.4,
            decay: 0.2,
            sustain: 0.7,
            release: 1.5
          },
          volume: baseVolume
        }).toDestination();
        
        // Synth 6: Now using MonoSynth for better audibility (2+3)
        synths.synth6 = new Tone.MonoSynth({
          oscillator: {
            type: "sawtooth"
          },
          envelope: {
            attack: 0.2,
            decay: 0.3,
            sustain: 0.6,
            release: 1.2
          },
          filterEnvelope: {
            attack: 0.1,
            decay: 0.2,
            sustain: 0.5,
            release: 1.0,
            baseFrequency: 300,
            octaves: 2
          },
          volume: baseVolume + 3 // Slightly louder
        }).toDestination();
        
        // Synth 7: Metal Synth (all 3)
        synths.synth7 = new Tone.MetalSynth({
          frequency: 200,
          envelope: {
            attack: 0.1,
            decay: 0.3,
            release: 0.8
          },
          harmonicity: 3.1,
          modulationIndex: 16,
          resonance: 3000,
          octaves: 1.5,
          volume: baseVolume
        }).toDestination();
        
        // Add reverb effect
        const reverb = new Tone.Reverb({
          decay: 4,
          wet: 0.5
        }).toDestination();
        
        // Connect all synths to reverb
        Object.values(synths).forEach(synth => {
          synth.connect(reverb);
        });
        
        console.log("Synths created successfully");
      }
      
              // Set up sequences for each synth in C major
      function setupSequences() {
        console.log("Setting up sequences...");
        
        // C major scale notes
        const cMajorNotes = ["C4", "D4", "E4", "G4", "A4", "C5"];
        const cMajorChords = [
          ["C3", "E3", "G3"], 
          ["E3", "G3", "C4"], 
          ["G3", "C4", "E4"]
        ];
        
        // Simple patterns for each synth
        const pattern1 = [cMajorNotes[0], cMajorNotes[2], cMajorNotes[4], cMajorNotes[1]];
        const pattern2 = [cMajorNotes[5], cMajorNotes[3], cMajorNotes[1], cMajorNotes[2]];
        const pattern3 = [cMajorNotes[3], null, cMajorNotes[2], null, cMajorNotes[0], null];
        
        // Rhythm variation with sine oscillation
        let rhythmPhase = 0;
        const rhythmSpeed = 0.05;
        
        function getRhythmValue() {
          // Generate a value between 0.5 and 1.5 based on sine wave
          const sineValue = Math.sin(rhythmPhase);
          rhythmPhase += rhythmSpeed;
          return 0.8 + (sineValue * 0.3); // Varies between 0.5 and 1.1
        }
        
        // Single loop that checks button combinations and plays the appropriate synth
        synths.mainLoop = new Tone.Loop((time) => {
          // Update rhythm factor
          const rhythmFactor = getRhythmValue();
          const noteDuration = rhythmFactor < 0.7 ? "4n" : "2n";
          
          // Check button combinations to determine which synth to play
          let notePlayed = false;
          
          if (state.button1 && state.button2 && state.button3) {
            // All three buttons - play synth 7
            const randomIndex = Math.floor(Math.random() * cMajorChords.length);
            const chord = cMajorChords[randomIndex];
            // Play each note of the chord individually
            chord.forEach(note => {
              synths.synth7.triggerAttackRelease(note, noteDuration, time);
            });
            pulseShape(shapes.shape7);
            notePlayed = true;
          } 
          else if (state.button1 && state.button2) {
            // Buttons 1 and 2 - play synth 4
            const note = cMajorNotes[Math.floor(Math.random() * cMajorNotes.length)];
            synths.synth4.triggerAttackRelease(note, noteDuration, time);
            pulseShape(shapes.shape4);
            notePlayed = true;
          } 
          else if (state.button1 && state.button3) {
            // Buttons 1 and 3 - play synth 5
            const randomIndex = Math.floor(Math.random() * cMajorChords.length);
            const chord = cMajorChords[randomIndex];
            // Play each note of the chord individually
            chord.forEach(note => {
              synths.synth5.triggerAttackRelease(note, noteDuration, time);
            });
            pulseShape(shapes.shape5);
            notePlayed = true;
          } 
          else if (state.button2 && state.button3) {
            // Buttons 2 and 3 - play synth 6
            const note = cMajorNotes[Math.floor(Math.random() * cMajorNotes.length)];
            synths.synth6.triggerAttackRelease(note, noteDuration, time);
            pulseShape(shapes.shape6);
            notePlayed = true;
          } 
          else if (state.button1) {
            // Only button 1 - play synth 1
            const note = pattern1[Math.floor(Math.random() * pattern1.length)];
            if (note !== null) {
              synths.synth1.triggerAttackRelease(note, noteDuration, time);
              pulseShape(shapes.shape1);
              notePlayed = true;
            }
          } 
          else if (state.button2) {
            // Only button 2 - play synth 2
            const note = pattern2[Math.floor(Math.random() * pattern2.length)];
            if (note !== null) {
              synths.synth2.triggerAttackRelease(note, noteDuration, time);
              pulseShape(shapes.shape2);
              notePlayed = true;
            }
          } 
          else if (state.button3) {
            // Only button 3 - play synth 3
            const note = pattern3[Math.floor(Math.random() * pattern3.length)];
            if (note !== null) {
              synths.synth3.triggerAttackRelease(note, noteDuration, time);
              pulseShape(shapes.shape3);
              notePlayed = true;
            }
          }
        }, "8n").start(0);
        
        Tone.Transport.bpm.value = 85; // Slightly faster than previous
        console.log("Sequences set up successfully");
      }
      
      // Animation function for shapes
      function pulseShape(shape) {
        const currentOpacity = shape.style.opacity;
        if (currentOpacity !== "0") {
          shape.style.transform = "scale(1.1)";
          setTimeout(() => {
            shape.style.transform = "scale(1)";
          }, 150);
        }
      }
      
      // Update visuals based on active synths
      function updateVisuals() {
        // Clear all shapes first
        Object.values(shapes).forEach(shape => {
          shape.style.opacity = "0";
        });
        
        // Determine which shape to show based on button combinations
        if (state.button1 && state.button2 && state.button3) {
          // All three buttons - only show synth 7
          shapes.shape7.style.opacity = "1";
        } else if (state.button1 && state.button2) {
          // Buttons 1 and 2 - only show synth 4
          shapes.shape4.style.opacity = "1";
        } else if (state.button1 && state.button3) {
          // Buttons 1 and 3 - only show synth 5
          shapes.shape5.style.opacity = "1";
        } else if (state.button2 && state.button3) {
          // Buttons 2 and 3 - only show synth 6
          shapes.shape6.style.opacity = "1";
        } else if (state.button1) {
          // Only button 1 - show synth 1
          shapes.shape1.style.opacity = "1";
        } else if (state.button2) {
          // Only button 2 - show synth 2
          shapes.shape2.style.opacity = "1";
        } else if (state.button3) {
          // Only button 3 - show synth 3
          shapes.shape3.style.opacity = "1";
        }
      }
      
      // Event listeners for buttons
      for (const [key, button] of Object.entries(buttons)) {
        button.addEventListener('click', async function() {
          // Start audio context on first click
          if (!audioStarted) {
            try {
              statusEl.textContent = "Starting audio...";
              await Tone.start();
              
              // Play a test tone
              testAudio();
              
              // Create all synths
              createSynths();
              
              // Set up loops
              setupSequences();
              
              // Start transport
              Tone.Transport.start();
              
              audioStarted = true;
              statusEl.textContent = "Audio initialized";
              
              // Hide status after a moment
              setTimeout(() => {
                statusEl.style.opacity = "0";
              }, 2000);
              
            } catch (error) {
              console.error("Error starting audio:", error);
              statusEl.textContent = "Error starting audio. Please try again.";
            }
          }
          
          // Toggle button state
          state[key] = !state[key];
          
          // Update button appearance
          if (state[key]) {
            button.classList.add('active');
          } else {
            button.classList.remove('active');
          }
          
          // Update visuals
          updateVisuals();
          
          console.log(`${key} state:`, state[key]);
        });
      }
    });
  </script>
</body>
</html>